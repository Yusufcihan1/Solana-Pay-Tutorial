 #Solana Pay Marketplace UygulamasÄ± 
 -------------------------------------

Sizlere Solana Pay kullanarak Solana'daki Ã¶demelerle ilgili kapsamlÄ± bir kÄ±lavuz hazÄ±rladÄ±m.BugÃ¼n Javascript kullanarak Marketplace uygulamasÄ± inÅŸa edeceÄŸiz.ArdÄ±ndan Solana Pay'in bÃ¼tÃ¼n nimetlerinden faydalanarak gerÃ§ek hayatta kripto ile Ã¶deme almanÄ±n ve iÅŸlem yapmanÄ±n tadÄ±nÄ± Ã§Ä±karacaÄŸÄ±z. :D
Size Solana'daki Ã¶demelerle ilgili bu kapsamlÄ± kÄ±lavuzu sunmaktan heyecan duyuyoruz.
BaÅŸlayalÄ±m! ğŸ‘‹

UYGULAMANIN AMACI :
----------------------
GerÃ§ek hayatta mÃ¼ÅŸterilerden Ã¶demeleri kabul etmemizi saÄŸlayan bir satÄ±ÅŸ noktasÄ± web uygulamasÄ± oluÅŸturacaÄŸÄ±z. MÃ¼ÅŸterilere tarama yapabilecekleri bir Solana cÃ¼zdanÄ±yla Ã¶deme yapmalarÄ±nÄ± saÄŸlayan bir QR kodu sunacaÄŸÄ±z. Ã–demeyi yaptÄ±klarÄ±nda uygulamamÄ±z gÃ¼ncellenecek ve Ã¶demelerini gÃ¶sterecektir. GerÃ§ekten bÃ¼yÃ¼leyici bir deneyim ve nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶rdÃ¼ÄŸÃ¼nÃ¼zde ne kadar kolay olduÄŸunu anlayacaksÄ±nÄ±z!

AyrÄ±ca Solana'da Ã§evrimiÃ§i Ã¶demeleri inceleyecek ve bir sadakat kartÄ± sistemi oluÅŸturacaÄŸÄ±z. KullanÄ±cÄ±lara her 5. satÄ±n alÄ±mda %50 indirim gibi iÃ§erikler Ã¼retebilirsiniz. AslÄ±nda istediÄŸiniz herhangi bir ÅŸeyi yapabilirsiniz, Ã§ok esnek bir sistem. Son olarak, tÃ¼m bunlarÄ± bir araya getiren gerÃ§ekten harika bir gelecek olan Solana Pay'in bazÄ± cool Ã¶zelliklerinede bir gÃ¶z atacaÄŸÄ±z!

![1](https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/a1bf785c-2d65-4823-9e32-d612e0af2a5a)
------------------------------------------------------------------------------------------------------------------------------
![2](https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/192f40b9-b97b-4bfa-8ad8-33ac8593b0ba)
------------------------------------------------------------------------------------------------------------------------------
![3](https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/b73ce982-6fe3-4391-9a38-30644b68dfc9)
------------------------------------------------------------------------------------------------------------------------------

UygulamanÄ±n demo halini https://sol-music-shop-v8bx-5p1q2u2zc-yusufcihan1.vercel.app/ adresinden inceleyebilirsiniz.

NEDEN SOLANA'DA iNÅA EDÄ°YORUZ ? 
---------------------------------------
Ã–ncelikle, Solana nedir? Solana, geliÅŸtiricilerin muhteÅŸem uygulamalar oluÅŸturabilecekleri bir blok zinciridir! Ã–deme kullanÄ±m senaryosu iÃ§in mÃ¼kemmel kÄ±lan iki ana Ã¶zelliÄŸi vardÄ±r:
Son derece hÄ±zlÄ±dÄ±r. Bir maÄŸazada kartla Ã¶deme yapmak kadar hÄ±zlÄ±dÄ±r. Daha Ã¶nce baÅŸka blok zincirleri kullandÄ±ysanÄ±z ve iÅŸlemlerin gerÃ§ekleÅŸmesini 10 saniye gibi bir sÃ¼re beklediyseniz, Solana'da bunu unutabilirsiniz.
Ãœcretler Ã§ok dÃ¼ÅŸÃ¼ktÃ¼r. BirkaÃ§ kuruÅŸluk miktarlardadÄ±r. Daha Ã¶nce bir NFT veya benzer bir ÅŸey satÄ±n aldÄ±ÄŸÄ±nÄ±zda 50 dolarlÄ±k iÅŸlem Ã¼creti Ã¶dediyseniz, Solana'da bunu da unutabilirsiniz.
BurasÄ±, bÃ¼yÃ¼kannenizin blok zinciri deÄŸil!
Ä°ÅŸte size bazÄ± istatistikler : 
![image](https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/e863db97-4aaf-47f6-80dd-3fbeb17c162a)

-AÄŸ ÅŸu anda saniyede 2.070 iÅŸlemi yÃ¶netiyor.
-Ortalama iÅŸlem baÅŸÄ±na maliyet 0.00025 dolar.
-AÄŸ ÅŸu ana kadar neredeyse 62,3 milyar iÅŸlem gerÃ§ekleÅŸtirdi. Bu metni okuduÄŸunuzda, yÃ¼z milyonlarca daha fazla iÅŸlemin gerÃ§ekleÅŸmiÅŸ olmasÄ± muhtemeldir.

Peki,SOLANA PAY NEDÄ°R ? 
Solana Pay, Solana Ã¼zerinde Ã¶demeler iÃ§in bir spesifikasyondur. Bir Ã¶deme talebini URL olarak kodlamak iÃ§in bir yol tanÄ±mlar ve kullanÄ±cÄ±lara gÃ¶sterilebilir ( Ã¶rneÄŸin bir QR kodu olarak). Solana mobil cÃ¼zdanlar, bu QR kodunu sorunsuz bir ÅŸekilde tarayarak Ã¶deme yapmayÄ± destekliyor.
KÄ±sacasÄ±, Solana Pay gerÃ§ek hayatta Ã¶demeleri harika bir ÅŸekilde Ã§alÄ±ÅŸtÄ±rÄ±r. Bunun nedeni, Solana'nÄ±n sunduÄŸu Ã¶zelliklerdir: herhangi bir kart makinesi kadar hÄ±zlÄ± Ã§alÄ±ÅŸÄ±r ve herhangi bir kredi kartÄ± iÅŸleminden Ã§ok daha ucuzdur.

KURULUM : 
Phantom CÃ¼zdan (https://phantom.app/download)
Phantom cÃ¼zdan Ã¼zerinde ikinci bir hesap aÃ§Ä±n.
Devnet Sol  (https://solfaucet.com/)

TarayÄ±cÄ± CÃ¼zdanÄ±
------------------

Ä°lk olarak, sizi Solana blok zincirine dahil etmek iÃ§in bir tarayÄ±cÄ± cÃ¼zdanÄ± oluÅŸturarak baÅŸlayacaÄŸÄ±z! DiÄŸer blok zincirlerinde olduÄŸu gibi, cÃ¼zdanlar bakiyelerimizi takip etmek ve uygulamalarla etkileÅŸimde bulunmak iÃ§in kullandÄ±ÄŸÄ±mÄ±z araÃ§lardÄ±r. EÄŸer zaten bir Solana cÃ¼zdanÄ±nÄ±z varsa, bu adÄ±mÄ± hÄ±zlÄ±ca geÃ§ebilirsiniz!

En popÃ¼ler tarayÄ±cÄ± cÃ¼zdanÄ± Phantom adÄ±nÄ± taÅŸÄ±maktadÄ±r ve aÅŸaÄŸÄ±daki web sitesinden indirebilirsiniz: https://phantom.app/download. Chrome, Brave, Firefox ve Edge iÃ§in tarayÄ±cÄ± eklentilerine sahiptir, bu yÃ¼zden bÃ¼yÃ¼k ihtimalle kullandÄ±ÄŸÄ±nÄ±z tarayÄ±cÄ±ya uygun bir seÃ§enek bulunmaktadÄ±r! BaÅŸka bir cÃ¼zdan kullanmak isterseniz herhangi bir nedenle, serbestÃ§e tercih edebilirsiniz, hepsi birbiriyle uyumludur.

Phantom ilk aÃ§Ä±ldÄ±ÄŸÄ±nda yeni bir cÃ¼zdan oluÅŸturma veya mevcut bir cÃ¼zdanÄ± iÃ§e aktarma seÃ§eneÄŸi sunacaktÄ±r:

<img width="448" alt="4" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/338da127-626b-4b02-a8c6-428f4ec98d18">

Solana'yÄ± daha Ã¶nce kullanmadÄ±ysanÄ±z "Yeni bir cÃ¼zdan oluÅŸtur"a tÄ±klayÄ±n. Terminoloji konusunda hÄ±zlÄ± bilgi, burada oluÅŸturduÄŸunuz bir cÃ¼zdan aynÄ± zamanda bir "Hesap"tÄ±r. Solana'nÄ±n hesap modeline daha sonra deÄŸineceÄŸiz, ancak etrafÄ±nÄ±za baktÄ±ÄŸÄ±nÄ±zda bu terimi gÃ¶rebilirsiniz.

Sizden bir parola oluÅŸturmanÄ±z istenecektir, bu yalnÄ±zca Phantom uzantÄ±sÄ± iÃ§indir.

Daha sonra size Gizli Kurtarma Ä°fadeniz sunulacaktÄ±r. Daha Ã¶nce herhangi bir blockchain kullandÄ±ysanÄ±z, buna aÅŸina olacaksÄ±nÄ±z! Gizli Kurtarma Ä°fadeniz 12 rastgele kelime olacaktÄ±r. Bu, Phantom'da oluÅŸturduÄŸunuz tÃ¼m cÃ¼zdanlara eriÅŸmek, Ã¶rneÄŸin onlarÄ± baÅŸka bir cÃ¼zdana aktarmak iÃ§in kullanÄ±labilir. Bunu asla kimseyle paylaÅŸmadÄ±ÄŸÄ±nÄ±zdan emin olun, tÃ¼m cÃ¼zdanlarÄ±nÄ±za eriÅŸebilecekler. Bir yere kaydedin, cÃ¼zdanlarÄ±nÄ±zÄ± baÅŸka bir yere aktarmak istediÄŸinizde ihtiyacÄ±nÄ±z olacak!

Kurulumu tamamladÄ±ktan sonra cÃ¼zdanÄ±nÄ±zÄ± Phantom'da gÃ¶rebileceksiniz:

<img width="377" alt="5" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/75fb9ddf-0ea2-43dd-b886-371da3ddd3d0">

BaÅŸka bir ÅŸey yapmadan Ã¶nce Devnet'e geÃ§elim. Devnet'te tÃ¼m jetonlar sahtedir ve gerÃ§ek dÃ¼nyada hiÃ§bir deÄŸeri yoktur, bu yÃ¼zden Ã¶ÄŸrenmek iÃ§in harikadÄ±r! Kendimize Ã¼cretsiz olarak Solana da gÃ¶nderebiliriz ki bu kullanÄ±ÅŸlÄ±dÄ±r!
Phantom'da Ayarlar'a gidin (saÄŸ alttaki diÅŸli simgesi), "AÄŸÄ± DeÄŸiÅŸtir"i seÃ§in ve "Devnet"i seÃ§in.

Devnet SOL alalÄ±m
--------------------

Tamam, "0 SOL" olayÄ± oldukÃ§a sÄ±kÄ±cÄ±, biraz Solana ile oynamak iÃ§in biraz SOL edinelim! https://solfaucet.com/ adresine gidin ve adresinizi girin. Phantom'da adresiniz Ã¼st kÄ±sÄ±mda kÄ±rpÄ±lmÄ±ÅŸ olarak gÃ¶sterilir ve tÃ¼mÃ¼nÃ¼ kopyalamak iÃ§in tÄ±klayabilirsiniz:

<img width="361" alt="6" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/c3f23e8a-49ab-4a47-af4b-7a94aa5abe03">

Adresinizi solfaucet'e yapÄ±ÅŸtÄ±rÄ±n ve Devnet'e tÄ±klayÄ±n:

<img width="970" alt="7" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/c742ef73-ae74-41f9-a7d9-9b4dba274e4e">

Bu arada,her airdrop iÃ§in geÃ§erli limit 2 SOL'dir. Bu eÄŸitim iÃ§in fazlasÄ±yla yeterli olmalÄ± :)
Hemen bir baÅŸarÄ± mesajÄ± aldÄ±ÄŸÄ±nÄ±zÄ± fark edeceksiniz:

<img width="397" alt="8" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/0e0c1818-cb1b-4325-95ff-9e7573cf9765">

Solana'nÄ±n hÄ±zlÄ± olduÄŸundan bahsetmiÅŸ miydim? ğŸš€
Phantom'u kontrol edin ve bakiyenizin artÄ±k 1 SOL olduÄŸunu gÃ¶receksiniz! GÃ¼zel!

Ä°kinci bir cÃ¼zdan (hesap) ekleme
----------------------------------

Ã–demelerle uÄŸraÅŸÄ±rken iki hesaba ihtiyacÄ±mÄ±z var: biri alÄ±cÄ±, diÄŸeri satÄ±cÄ± iÃ§in. AlÄ±cÄ± satÄ±cÄ±ya Ã¶der! Åimdiye kadar bir hesap oluÅŸturduk ve ona bir ÅŸeyler satÄ±n almak iÃ§in kullanabileceÄŸi bir miktar SOL verdik. Åimdi satÄ±cÄ± hesabÄ±mÄ±zÄ± yapalÄ±m.
Phantom'da sol Ã¼stteki menÃ¼yÃ¼ aÃ§abilir ve yeni bir cÃ¼zdan ekleyebilirsiniz:

<img width="360" alt="9" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/42c4ae26-2163-4925-b827-17fb50200fd7">

Bir parola vermenizin istenmeyeceÄŸini veya bir Gizli Kurtarma Ä°fadesi gÃ¶sterilmeyeceÄŸini unutmayÄ±n. ParolanÄ±n Phantom uzantÄ±sÄ± iÃ§in olduÄŸunu (tÃ¼m cÃ¼zdanlarÄ±n kilidini aÃ§ar) ve Gizli Kurtarma Ä°fadesinin de tÃ¼m cÃ¼zdanlar iÃ§in olduÄŸunu unutmayÄ±n!
Son bir ÅŸey, Phantom'da (ve Ã§oÄŸu cÃ¼zdan uygulamasÄ±nda) cÃ¼zdanlarÄ±nÄ±zÄ± tanÄ±mlamayÄ± kolaylaÅŸtÄ±rmak iÃ§in adlandÄ±rabilirsiniz. Bu, Ayarlar altÄ±ndadÄ±r:

<img width="365" alt="10" src="https://github.com/Yusufcihan1/Solana-Pay-Marketplace-Uygulamasi/assets/50721899/16d09d71-1196-41b7-b422-78d315a70a0d">

Ä°lk cÃ¼zdanÄ± (SOL'lu olan) "AlÄ±cÄ±" ve ikincisini "MaÄŸaza" olarak adlandÄ±rmanÄ±zÄ± tavsiye ederim. Bu isimlerin sadece size ait olduÄŸunu, blok zincirine hiÃ§bir ÅŸekilde yansÄ±mayacaÄŸÄ±nÄ± unutmayÄ±n. Ama Phantom'u kullanmayÄ± Ã§ok daha gÃ¼zel hale getirecekler!

BaÅŸlangÄ±Ã§ Kodunu Ä°ndirin
----------------------------
Bu Ã¶ÄŸretici Solana Pay ile ilgili olduÄŸu iÃ§in Html,Css ve Javascript kullanarak oluÅŸturulan template kodunu hazÄ±r olarak Ã§ekiyoruz.

$ git clone -b start https://github.com/Yusufcihan1/Solana-Pay-Tutorial

Bu bir NextJS uygulamasÄ±dÄ±r. npm ile Ã§alÄ±ÅŸtÄ±rabilirsiniz:  
```
$ npm install
$ npm run dev
```
VarsayÄ±lan olarak localhost:3000 Ã¼zerinde Ã§alÄ±ÅŸÄ±r. Ã‡alÄ±ÅŸÄ±rken tarayÄ±cÄ±nÄ±zda aÃ§Ä±n ve ÅŸÃ¶yle bir ÅŸey gÃ¶rmelisiniz:

![11](https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/47859b46-98e0-4343-a889-c717f4d85bf7)

BaÅŸlangÄ±Ã§ kodu size bazÄ± Ã¼rÃ¼nleri seÃ§ip sipariÅŸ verebileceÄŸimiz basit bir e-ticaret arayÃ¼zÃ¼ sunar!Bu Ã¶deme sayfasÄ± ÅŸu anda biraz Ã§Ä±plak gÃ¶rÃ¼nÃ¼yor.

KODUMUZU Ã–ZELLEÅTÄ°RELÄ°M
--------------------------
GÃ¶rÃ¼ntÃ¼lenen Ã¼rÃ¼nler lib/products.ts 'dedir, tanÄ±mlama bilgileri dÄ±ÅŸÄ±nda bir ÅŸey satmak istiyorsanÄ±z bunlarÄ± deÄŸiÅŸtirmekten Ã§ekinmeyin!

```
export const products = [
  {
    id: 'box-of-cookies',
    name: 'Box',
    description: 'A delicious box of handmade cookies',
    unitName: 'box', // shows after the price, eg. 0.05 SOL/box
    priceSol: 0.05,
    priceUsd: 5,
  },
  {
    id: 'basket-of-cookies',
    name: 'Basket',
    description: 'A large basket of handmade cookies',
    unitName: 'basket',
    priceSol: 0.1,
    priceUsd: 10,
  }
]
```

Renklerin, yazÄ± tiplerinin hayranÄ± deÄŸilseniz, bu sizin uygulamanÄ±z! Ä°stediÄŸinizi deÄŸiÅŸtirmekte Ã¶zgÃ¼rsÃ¼nÃ¼z :)

SATIÅ MANTIÄI
------------------------
Solana Pay ile Ã¶demeleri almak iÃ§in bir satÄ±ÅŸ noktasÄ± uygulamasÄ± oluÅŸturmaya gÃ¶z atmadan Ã¶nce, uygulamamÄ±zÄ±n basit bir e-ticaret maÄŸazasÄ± gibi Ã§alÄ±ÅŸmasÄ±nÄ± saÄŸlayalÄ±m.KullanÄ±cÄ±larÄ±n sipariÅŸleri iÃ§in tarayÄ±cÄ± cÃ¼zdanlarÄ±nda SOL kullanarak Ã¶deme yapmasÄ±na izin verelim. Bu bize Solana iÅŸlemlerinin nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ± (daha fazlasÄ±nÄ± ileride gÃ¶receÄŸiz!) ve Solana Pay'in perde arkasÄ±nda ne yaptÄ±ÄŸÄ± hakkÄ±nda bir fikir verecektir.

BazÄ± baÄŸÄ±mlÄ±lÄ±klarÄ± yÃ¼kleyerek baÅŸlayalÄ±m. Bunlar Solana tarafÄ±ndan saÄŸlanÄ±r ve gÃ¼zel bir kullanÄ±cÄ± arayÃ¼zÃ¼ ve React entegrasyonu ile cÃ¼zdan baÄŸlantÄ±sÄ±nÄ± yÃ¶netir:

```
$ npm install @solana/web3.js @solana/wallet-adapter-react @solana/wallet-adapter-react-ui @solana/wallet-adapter-base @solana/wallet-adapter-wallets
```
Daha sonra bileÅŸen hiyerarÅŸimizin en Ã¼stÃ¼ne Solana baÄŸlantÄ±sÄ±nÄ± ve baÄŸlÄ± cÃ¼zdanÄ± iÅŸlemek iÃ§in kod eklememiz gerekiyor. Blok zincirine istekte bulunmak iÃ§in bir Solana baÄŸlantÄ±sÄ±nÄ± ve kullanÄ±cÄ±dan Ã¶deme yapmasÄ±nÄ± istemek iÃ§in baÄŸlÄ± cÃ¼zdanÄ± kullanacaÄŸÄ±z. Pages/ app.tsx'i aÅŸaÄŸÄ±daki gibi gÃ¶rÃ¼necek ÅŸekilde gÃ¼ncelleyin:

```
import '../styles/globals.css'
import type { AppProps } from 'next/app'
import Layout from '../components/Layout'
import Head from 'next/head'
import { ConnectionProvider, WalletProvider } from '@solana/wallet-adapter-react'
import { WalletModalProvider } from '@solana/wallet-adapter-react-ui'
import { WalletAdapterNetwork } from '@solana/wallet-adapter-base'
import { clusterApiUrl } from '@solana/web3.js'
import { PhantomWalletAdapter, SolflareWalletAdapter } from '@solana/wallet-adapter-wallets'

// Default styles that can be overridden by your app
require('@solana/wallet-adapter-react-ui/styles.css');

function MyApp({ Component, pageProps }: AppProps) {
  // The network can be set to 'devnet', 'testnet', or 'mainnet-beta'.
  const network = WalletAdapterNetwork.Devnet;

  // You can also provide a custom RPC endpoint.
  const endpoint = clusterApiUrl(network);

  // @solana/wallet-adapter-wallets includes all the adapters but supports tree shaking and lazy loading --
  // Only the wallets you configure here will be compiled into your application, and only the dependencies
  // of wallets that your users connect to will be loaded.
  const wallets = [
    new PhantomWalletAdapter(),
    new SolflareWalletAdapter({ network }),
  ];

  return (
    <ConnectionProvider endpoint={endpoint}>
      <WalletProvider wallets={wallets} autoConnect>
        <WalletModalProvider>
          <Layout>
            <Head>
              <title>Cookies Inc</title>
            </Head>
            <Component {...pageProps} />
          </Layout>
        </WalletModalProvider>
      </WalletProvider>
    </ConnectionProvider>
  )
}

export default MyApp
```
Burada pek Ã§ok yenilik var! Devnet Solana aÄŸÄ±na baÄŸlantÄ± oluÅŸturuyoruz. AyrÄ±ca uygulamamÄ±za baÄŸlanmasÄ±na izin vermek istediÄŸimiz cÃ¼zdanlarÄ± da tanÄ±mlÄ±yoruz. Burada Phantom ve Solflare kullandÄ±m, ancak bir sÃ¼rÃ¼ cÃ¼zdan iÃ§in adaptÃ¶r var, bu yÃ¼zden istediÄŸiniz cÃ¼zdanlarÄ± eklemekten Ã§ekinmeyin! UÃ§ noktayÄ± ve cÃ¼zdanlarÄ± tanÄ±mladÄ±ktan sonra, uygulamamÄ±zdaki her sayfadan Solana baÄŸlantÄ±sÄ±na ve baÄŸlÄ± herhangi bir cÃ¼zdana eriÅŸebilmemiz iÃ§in uygulamamÄ±zÄ± bazÄ± iÃ§erik saÄŸlayÄ±cÄ±lara baÄŸlÄ±yoruz. Bu kod, bu Solana kitaplÄ±klarÄ±nÄ± kullanan herhangi bir uygulamada hemen hemen aynÄ±dÄ±r.
Ana sayfamÄ±za cÃ¼zdan baÄŸlama Ã¶zelliÄŸini ekleyelim. 
Pages/index.tsx'i aÅŸaÄŸÄ±daki ÅŸekilde gÃ¼ncelleyin:

```
import { useWallet } from '@solana/wallet-adapter-react'
import { WalletMultiButton } from '@solana/wallet-adapter-react-ui'
import Products from '../components/Products'
import SiteHeading from '../components/SiteHeading'

export default function HomePage() {
  // We get the public key of the connected wallet, if there is one
  const { publicKey } = useWallet()

  return (
    <div className="flex flex-col gap-8 max-w-4xl items-stretch m-auto pt-24">
      <SiteHeading>Cookies Inc</SiteHeading>

      {/* We add the Solana wallet connect button */}
      <div className="basis-1/4">
        <WalletMultiButton className='!bg-gray-900 hover:scale-105' />
      </div>

      {/* We disable checking out without a connected wallet */}
      <Products submitTarget='/checkout' enabled={publicKey !== null} />
    </div>
  )
}

```
Ufak bir isim deÄŸiÅŸikliÄŸi ile dÃ¼kkanÄ±mÄ± kurabiye dÃ¼kkanÄ± haline getirdim.Siz istediÄŸinizi yapmakta Ã¶zgÃ¼rsÃ¼nÃ¼z :D
Åimdi sayfa ÅŸÃ¶yle gÃ¶rÃ¼nmelidir:

![13](https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/13799aea-8767-4dcf-821e-e08b00b5c164)

"CÃ¼zdan SeÃ§" dÃ¼ÄŸmesini tÄ±klarsanÄ±z, cÃ¼zdanÄ±nÄ±zÄ± seÃ§mek iÃ§in bir mod gÃ¶rmelisiniz:

![14](https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/d1d2d747-b3ba-4378-bf0c-a336e2b6dc72)

Phantom'a tÄ±klayÄ±n (alÄ±cÄ± cÃ¼zdanÄ±nÄ± baÄŸladÄ±ÄŸÄ±nÄ±zdan emin olun) ve baÄŸlantÄ±yÄ± onaylayÄ±n. Sayfa ÅŸimdi ÅŸÃ¶yle gÃ¶rÃ¼nmelidir:

![15](https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/fc0db40f-ef39-4ed8-908d-6f77f637968a)

GÃ¼zel! CÃ¼zdanÄ± baÄŸlayÄ±p kontrol edebiliriz. Ã–deme sayfamÄ±z henÃ¼z bir ÅŸey yapmÄ±yor, bu yÃ¼zden bir sonraki iÅŸimiz bu.

```
GerÃ§ekte, bir e-ticaret satÄ±n alÄ±mÄ± iÃ§in alÄ±cÄ±nÄ±n adÄ± ve sipariÅŸlerin nereye teslim edilmesini istedikleri gibi daha fazla bilgi toplamamÄ±z gerekir. Bunu sadece Solana yapÄ±larÄ±nÄ± anlamak iÃ§in kullandÄ±ÄŸÄ±mÄ±z iÃ§in, onu burada atlayacaÄŸÄ±z.
```

Ä°ÅLEM OLUÅTURMA
----------------------
Ä°ÅŸlemi Ã¶n uÃ§ta oluÅŸturabilir ve kullanÄ±cÄ±nÄ±n cÃ¼zdanÄ±na gÃ¶nderebiliriz. Bunu yapan, Ã¶rneÄŸin NFT satÄ±n alan uygulamalar gÃ¶rmÃ¼ÅŸ olabilirsiniz. Ancak bir e-ticaret kullanÄ±m durumunda, iÅŸlemi oluÅŸturmak iÃ§in bir API yolu kullanmak daha mantÄ±klÄ±dÄ±r Ã§Ã¼nkÃ¼ bu bize beklenen iÅŸlemleri gÃ¼venilir bir ÅŸekilde kaydetme yeteneÄŸi verir. Ã–n uÃ§ta Ã§alÄ±ÅŸtÄ±rdÄ±ÄŸÄ±mÄ±z herhangi bir kodun mÃ¼ÅŸteri tarafÄ±ndan deÄŸiÅŸtirilebileceÄŸini unutmayÄ±n!

Ä°htiyacÄ±mÄ±z olan ilk ÅŸey maÄŸaza adresi. Bunu Ã¶ÄŸretici boyunca birkaÃ§ farklÄ± yerde kullanacaÄŸÄ±z, o yÃ¼zden yeni bir lib/addresses.ts dosyasÄ± oluÅŸturalÄ±m:

```
import { PublicKey } from "@solana/web3.js"

// Your shop wallet address
export const shopAddress = new PublicKey('...') 
```
MaÄŸaza adresinizi,Ã¼Ã§ noktanÄ±n iÃ§ine yazdÄ±ÄŸÄ±nÄ±zdan emin olun ('...') . Genel anahtarÄ±n adres iÃ§in kullandÄ±ÄŸÄ±mÄ±z baÅŸka bir terim olduÄŸunu unutmayÄ±n, bu nedenle adresi burada sadece Solana kitaplÄ±klarÄ±nÄ±n beklediÄŸi ÅŸekilde saklÄ±yoruz.

Tamam, API rotamÄ±zÄ± oluÅŸturalÄ±m. Yeni bir dosya oluÅŸturalÄ±m (page/api/makeTransaction.ts ). Belirli bir Ã¶deme iÃ§in bir iÅŸlem oluÅŸturmak iÃ§in bunu kullanacaÄŸÄ±z ve ardÄ±ndan Ã¶n uÃ§, kullanÄ±cÄ±dan bu iÅŸlemi onaylamasÄ±nÄ± isteyecektir.Bu arada, tÃ¼m bunlarÄ± anlamadÄ±ysanÄ±z endiÅŸelenmeyin, aÅŸaÄŸÄ±da gÃ¶zden geÃ§ireceÄŸim. Ä°ÅŸte bunun iÃ§in kod:

```
import { WalletAdapterNetwork } from "@solana/wallet-adapter-base"
import { clusterApiUrl, Connection, PublicKey, Transaction, SystemProgram, LAMPORTS_PER_SOL } from "@solana/web3.js"
import { NextApiRequest, NextApiResponse } from "next"
import { shopAddress } from "../../lib/addresses"
import calculatePrice from "../../lib/calculatePrice"

export type MakeTransactionInputData = {
  account: string,
}

export type MakeTransactionOutputData = {
  transaction: string,
  message: string,
}

type ErrorOutput = {
  error: string
}

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse<MakeTransactionOutputData | ErrorOutput>
) {
  try {
    // We pass the selected items in the query, calculate the expected cost
    const amount = calculatePrice(req.query)
    if (amount.toNumber() === 0) {
      res.status(400).json({ error: "Can't checkout with charge of 0" })
      return
    }

    // We pass the reference to use in the query
    const { reference } = req.query
    if (!reference) {
      res.status(400).json({ error: "No reference provided" })
      return
    }

    // We pass the buyer's public key in JSON body
    const { account } = req.body as MakeTransactionInputData
    if (!account) {
      res.status(400).json({ error: "No account provided" })
      return
    }
    const buyerPublicKey = new PublicKey(account)
    const shopPublicKey = shopAddress

    const network = WalletAdapterNetwork.Devnet
    const endpoint = clusterApiUrl(network)
    const connection = new Connection(endpoint)

    // Get a recent blockhash to include in the transaction
    const { blockhash } = await (connection.getLatestBlockhash('finalized'))

    const transaction = new Transaction({
      recentBlockhash: blockhash,
      // The buyer pays the transaction fee
      feePayer: buyerPublicKey,
    })

    // Create the instruction to send SOL from the buyer to the shop
    const transferInstruction = SystemProgram.transfer({
      fromPubkey: buyerPublicKey,
      lamports: amount.multipliedBy(LAMPORTS_PER_SOL).toNumber(),
      toPubkey: shopPublicKey,
    })

    // Add the reference to the instruction as a key
    // This will mean this transaction is returned when we query for the reference
    transferInstruction.keys.push({
      pubkey: new PublicKey(reference),
      isSigner: false,
      isWritable: false,
    })

    // Add the instruction to the transaction
    transaction.add(transferInstruction)

    // Serialize the transaction and convert to base64 to return it
    const serializedTransaction = transaction.serialize({
      // We will need the buyer to sign this transaction after it's returned to them
      requireAllSignatures: false
    })
    const base64 = serializedTransaction.toString('base64')

    // Insert into database: reference, amount

    // Return the serialized transaction
    res.status(200).json({
      transaction: base64,
      message: "Thanks for your order! ğŸª",
    })
  } catch (err) {
    console.error(err);

    res.status(500).json({ error: 'error creating transaction', })
    return
  }
}
```
YazdÄ±ÄŸÄ±mÄ±z kodlarÄ± biraz aÃ§Ä±klayalÄ±m ve sonra devam edelim.
API, girdi olarak bir JSON nesnesi {"account": "public-key"} alÄ±r ve ÅŸunu dÃ¶ndÃ¼rÃ¼r:

```
{
  "transaction": "base-64 encoded transaction",
  "message": "Thanks for your order! ğŸª"
}
```
AyrÄ±ca istek sorgusunda girdi alÄ±r:
Ana sayfadaki formda seÃ§ilen Ã¶ÄŸeler, Ã¶rneÄŸin kullanÄ±cÄ± 2 kutu Ã§erez satÄ±n aldÄ±ysa ?box-of-cookies=2. Bunun nasÄ±l gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ biraz daha gÃ¶rmek isterseniz, ana sayfada bazÄ± Ã¼rÃ¼nleri seÃ§ip kontrol etmeyi deneyin. Ã–deme URL'sinin ÅŸÃ¶yle gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ gÃ¶receksiniz: http://localhost:3000/checkout?box-of-cookies=2&basket-of-cookies=1. Åu anda Ã¶deme sayfasÄ±nda toplam fiyatÄ± gÃ¶rÃ¼ntÃ¼lemek iÃ§in URL'deki bu sorgu parametrelerini kullanÄ±yoruz, ancak Ã¼cretlendirilecek fiyatÄ± da hesaplayabilmesi iÃ§in bunlarÄ± API'mize ileteceÄŸiz.

Referans: const {referans} = req.query. Bu, Ã¶deme sayfasÄ±nda oluÅŸturacaÄŸÄ±mÄ±z yeni bir Solana genel anahtarÄ±dÄ±r. Bunu birazdan biraz daha aÃ§Ä±klayacaÄŸÄ±m.
API'mizin nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±na ve ne yaptÄ±ÄŸÄ±na biraz daha ayrÄ±ntÄ±lÄ± olarak gÃ¶z atalÄ±m.

```
const network = WalletAdapterNetwork.Devnet
const endpoint = clusterApiUrl(network)
const connection = new Connection(endpoint)
```
Bu, _app.tsx'te sahip olduÄŸumuz tÃ¼rden bir kod, Solana'nÄ±n devnet aÄŸÄ±na bir baÄŸlantÄ± baÅŸlatÄ±yoruz.

```
// Get a recent blockhash to include in the transaction
const { blockhash } = await (connection.getLatestBlockhash('finalized'))
```
Bir iÅŸlem yalnÄ±zca kÄ±sa bir sÃ¼re iÃ§in geÃ§erli olmalÄ±dÄ±r. Åimdiye kadar aÄŸda gÃ¶rÃ¼len en son bloÄŸu dahil ediyoruz ve iÅŸlem Ã§ok eskiyse reddedilebilir.

```
const transaction = new Transaction({
  recentBlockhash: blockhash,
  // The buyer pays the transaction fee
  feePayer: buyerPublicKey,
})
```
Burada yeni bir Solana iÅŸlemi oluÅŸturuyoruz. Yeni aldÄ±ÄŸÄ±mÄ±z Blockhash'i az Ã¶nce getirdiÄŸimiz bloÄŸa ayarlÄ±yoruz. AyrÄ±ca alÄ±cÄ±mÄ±zÄ± iÅŸlem iÃ§in Ã¼cret Ã¶deyen kiÅŸi olarak belirliyoruz. Bu, alÄ±cÄ±nÄ±n iÅŸlemi aÄŸ tarafÄ±ndan iÅŸlenmeden Ã¶nce imzalamasÄ± ve devam etmesi iÃ§in yetki vermesi gerektiÄŸi anlamÄ±na gelir.

```
// Create the instruction to send SOL from the buyer to the shop
const transferInstruction = SystemProgram.transfer({
  fromPubkey: buyerPublicKey,
  lamports: amount.multipliedBy(LAMPORTS_PER_SOL).toNumber(),
  toPubkey: shopPublicKey,
})
```
Bir Solana iÅŸlemi bir dizi talimat iÃ§erebilir ve atomiktir - ya hepsi baÅŸarÄ±lÄ± olur ya da iÅŸlem hiÃ§bir deÄŸiÅŸiklik olmaksÄ±zÄ±n baÅŸarÄ±sÄ±z olur. Bu durumda, iÅŸlemimizin tek bir talimatÄ± vardÄ±r: alÄ±cÄ±dan maÄŸazaya SOL gÃ¶nderin. MaÄŸazamÄ±zÄ±n ÅŸu anda SOL cinsinden fiyatlandÄ±rÄ±ldÄ±ÄŸÄ±nÄ±, ancak transfer talimatÄ±nÄ±n lamport cinsinden numara verilmesini beklediÄŸini unutmayÄ±n. 1 SOL'de 1 milyar (10^9) lamport vardÄ±r, ancak aralarÄ±nda dÃ¶nÃ¼ÅŸtÃ¼rme yaparken her zaman LAMPORTS_PER_SOL sabitini kullanmak en iyisidir.

```
// Add the reference to the instruction as a key
// This will mean this transaction is returned when we query for the reference
transferInstruction.keys.push({
  pubkey: new PublicKey(reference),
  isSigner: false,
  isWritable: false,
})

// Add the instruction to the transaction
transaction.add(transferInstruction)
```

Her talimatÄ±n kendisiyle iliÅŸkilendirilmiÅŸ bir dizi anahtarÄ± vardÄ±r. Ä°ÅŸlem, bu anahtarlardan herhangi biri tarafÄ±ndan aranabilir. Her anahtar bir imzalayÄ±cÄ± olabilir ve yazÄ±labilir. Bizim durumumuzda, transfer iÅŸlevi bazÄ± varsayÄ±lan tuÅŸlarla bir talimat oluÅŸturuyor:

AlÄ±cÄ± ortak anahtarÄ±: imzalayandÄ±r, Ã§Ã¼nkÃ¼ SOL'lerini aktarÄ±yorlar ve yetkilerini vermeleri gerekiyor. YazÄ±labilir, Ã§Ã¼nkÃ¼ SOL bakiyeleri deÄŸiÅŸecektir.

MaÄŸaza genel anahtarÄ±: yazÄ±labilir, Ã§Ã¼nkÃ¼ SOL bakiyeleri deÄŸiÅŸecektir. Ä°mzalayan deÄŸil, SOL almak iÃ§in yetki vermesine gerek yok.

YukarÄ±daki koda ek bir anahtar ekliyoruz:Referans. Bunun, belirli Ã¶deme oturumuna Ã¶zgÃ¼, API'mize girdi olarak iletilen bir genel anahtar olduÄŸunu unutmayÄ±n. Ä°mzalayan veya yazÄ±labilir olmasÄ± gerekmez, Ã§Ã¼nkÃ¼ gerÃ§ek SOL aktarÄ±mÄ±na dahil deÄŸildir. Ancak talimatÄ±mÄ±za ekleyerek, bu referansÄ± kullanarak iÅŸlemi arayabiliriz. Bu, Ã¶deme sayfamÄ±zÄ±n bir Ã¶deme yapÄ±ldÄ±ÄŸÄ±nÄ± algÄ±lamasÄ±nÄ± saÄŸlar!

Ekstra anahtarÄ± ekledikten sonra transfer talimatÄ±nÄ± iÅŸleme ekliyoruz. Ä°ÅŸlemimizin artÄ±k bir talimatÄ± var.

```
// Serialize the transaction and convert to base64 to return it
const serializedTransaction = transaction.serialize({
  // We will need the buyer to sign this transaction after it's returned to them
  requireAllSignatures: false
})
const base64 = serializedTransaction.toString('base64')
```

Ä°ÅŸlemi serileÅŸtiriyoruz ve ardÄ±ndan base-64'e dÃ¶nÃ¼ÅŸtÃ¼rÃ¼yoruz. Bu, onu API'den dÃ¶ndÃ¼rmemize ve /checkout sayfasÄ±nda tÃ¼ketmemize izin verecektir. Ä°ÅŸlemimiz alÄ±cÄ±nÄ±n imzasÄ±nÄ± gerektirdiÄŸinden ve henÃ¼z buna sahip olmadÄ±ÄŸÄ±mÄ±zdan serileÅŸtirdiÄŸimizde requestAllSignatures: false deÄŸerini iletmeliyiz. /checkout sayfasÄ±ndaki baÄŸlÄ± cÃ¼zdanlarÄ±ndan talep edeceÄŸiz.

```
Devam etmeden Ã¶nce son bir ÅŸey: GerÃ§ekte bu iÅŸlemi API Ã§aÄŸrÄ±sÄ±nÄ±n bir parÃ§asÄ± olarak bir veritabanÄ±na kaydetmek isteyeceksiniz. Bu, daha sonra Ã¼cretli iÅŸlemin doÄŸru olduÄŸunu doÄŸrulamamÄ±za olanak tanÄ±r. Yine burada Solana yapÄ±larÄ±na odaklandÄ±ÄŸÄ±mÄ±z iÃ§in bu eÄŸitimde onu atladÄ±m.
```

Ä°ÅŸlemin talep edilmesi
----------------------

Ã–ncelikle, bu API'yi Ã§aÄŸÄ±rabileceÄŸimizden ve dÃ¶ndÃ¼rÃ¼len iÅŸlemin serisini kaldÄ±rabileceÄŸimizden emin olalÄ±m.

pages/checkout.tsx'i aÅŸaÄŸÄ±daki ÅŸekilde gÃ¼ncelleyin:

```
import { useWallet } from "@solana/wallet-adapter-react";
import { WalletMultiButton } from "@solana/wallet-adapter-react-ui";
import { Keypair, Transaction } from "@solana/web3.js";
import { useRouter } from "next/router";
import { useEffect, useMemo, useState } from "react";
import BackLink from "../components/BackLink";
import Loading from "../components/Loading";
import { MakeTransactionInputData, MakeTransactionOutputData } from "./api/makeTransaction";

export default function Checkout() {
  const router = useRouter();
  const { publicKey } = useWallet();

  // State to hold API response fields
  const [transaction, setTransaction] = useState<Transaction | null>(null);
  const [message, setMessage] = useState<string | null>(null);

  // Read the URL query (which includes our chosen products)
  const searchParams = new URLSearchParams();
  for (const [key, value] of Object.entries(router.query)) {
    if (value) {
      if (Array.isArray(value)) {
        for (const v of value) {
          searchParams.append(key, v);
        }
      } else {
        searchParams.append(key, value);
      }
    }
  }

  // Generate the unique reference which will be used for this transaction
  const reference = useMemo(() => Keypair.generate().publicKey, []);

  // Add it to the params we'll pass to the API
  searchParams.append('reference', reference.toString());

  // Use our API to fetch the transaction for the selected items
  async function getTransaction() {
    if (!publicKey) {
      return;
    }

    const body: MakeTransactionInputData = {
      account: publicKey.toString(),
    }

    const response = await fetch(`/api/makeTransaction?${searchParams.toString()}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body),
    })

    const json = await response.json() as MakeTransactionOutputData

    if (response.status !== 200) {
      console.error(json);
      return;
    }

    // Deserialize the transaction from the response
    const transaction = Transaction.from(Buffer.from(json.transaction, 'base64'));
    setTransaction(transaction);
    setMessage(json.message);
    console.log(transaction);
  }

  useEffect(() => {
    getTransaction()
  }, [publicKey])

  if (!publicKey) {
    return (
      <div className='flex flex-col gap-8 items-center'>
        <div><BackLink href='/'>Cancel</BackLink></div>

        <WalletMultiButton />

        <p>You need to connect your wallet to make transactions</p>
      </div>
    )
  }

  return (
    <div className='flex flex-col gap-8 items-center'>
      <div><BackLink href='/'>Cancel</BackLink></div>

      <WalletMultiButton />

      {message ?
        <p>{message} Please approve the transaction using your wallet</p> :
        <p>Creating transaction... <Loading /></p>
      }
    </div>
  )
}
```

Burada oldukÃ§a fazla yenilik var! AdÄ±m adÄ±m ilerleyelim:

```
const { publicKey } = useWallet();
```
Bu sadece baÄŸlÄ± cÃ¼zdanÄ± ana sayfadan okur. BaÄŸlÄ± cÃ¼zdan yoksa boÅŸ olacaktÄ±r.
```
// State to hold API response fields
const [transaction, setTransaction] = useState<Transaction | null>(null);
const [message, setMessage] = useState<string | null>(null);
```
API'miz bir iÅŸlem + bir mesaj dÃ¶ndÃ¼rÃ¼r, bu yÃ¼zden bunlarÄ± aldÄ±ÄŸÄ±mÄ±zda yanÄ±ttan ayarlayacaÄŸÄ±z.
```
// Read the URL query (which includes our chosen products)
const searchParams = new URLSearchParams();
for (const [key, value] of Object.entries(router.query)) {
  if (value) {
    if (Array.isArray(value)) {
      for (const v of value) {
        searchParams.append(key, v);
      }
    } else {
      searchParams.append(key, value);
    }
  }
}
```
Sadece sorgu parametrelerini bir URLSearchParams nesnesine dÃ¶nÃ¼ÅŸtÃ¼rdÃ¼k. Bununla Ã§alÄ±ÅŸmak, Next.js'in bize sorgu parametreleri iÃ§in verdiÄŸinden daha kolaydÄ±r! SeÃ§ilen Ã¼rÃ¼nlerin sorgu parametrelerinde olduÄŸunu ve bunlarÄ± API'mize aktarmamÄ±z gerektiÄŸini unutmayÄ±n.

```
// Generate the unique reference which will be used for this transaction
const reference = useMemo(() => Keypair.generate().publicKey, []);

// Add it to the params we'll pass to the API
searchParams.append('reference', reference.toString());
```

Bu, API'de dÃ¶ndÃ¼rdÃ¼ÄŸÃ¼mÃ¼z referanstÄ±r. Bu sayfada Ã¼retiyoruz ve geÃ§mekte olduÄŸumuz parametrelere ekliyoruz. Bunu kÄ±sa sÃ¼re sonra iÅŸlemi tespit etmek iÃ§in kullanabileceÄŸiz.
```
// Use our API to fetch the transaction for the selected items
async function getTransaction() {
  if (!publicKey) {
    return;
  }

  const body: MakeTransactionInputData = {
    account: publicKey.toString(),
  }

  const response = await fetch(`/api/makeTransaction?${searchParams.toString()}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body),
  })

  const json = await response.json() as MakeTransactionOutputData

  if (response.status !== 200) {
    console.error(json);
    return;
  }

  // Deserialize the transaction from the response
  const transaction = Transaction.from(Buffer.from(json.transaction, 'base64'));
  setTransaction(transaction);
  setMessage(json.message);
  console.log(transaction);
}

useEffect(() => {
  getTransaction()
}, [publicKey])
```

/api/makeTransaction'Ä±mÄ±za bir API Ã§aÄŸrÄ±sÄ± yapÄ±yoruz ve bunu sorgu parametrelerimiz + hesap gÃ¶vdesi iletiyoruz. Base64'ten gelen yanÄ±tÄ±n kodunu Ã§Ã¶zÃ¼yoruz ve seriyi kaldÄ±rÄ±p bir Transaction nesnesine geri dÃ¶ndÃ¼rÃ¼yoruz.

```
if (!publicKey) {
  return (
    <div className='flex flex-col gap-8 items-center'>
      <div><BackLink href='/'>Cancel</BackLink></div>

      <WalletMultiButton />

      <p>You need to connect your wallet to make transactions</p>
    </div>
  )
}

return (
  <div className='flex flex-col gap-8 items-center'>
    <div><BackLink href='/'>Cancel</BackLink></div>

    <WalletMultiButton />

    {message ?
      <p>{message} Please approve the transaction using your wallet</p> :
      <p>Creating transaction... <Loading /></p>
    }
  </div>
)
```

Renderimiz ÅŸimdi biraz daha ilginÃ§! Ä°lk Ã¶nce bir publicKey'in olmadÄ±ÄŸÄ± durumu ele alÄ±yoruz - bu olmadan iÅŸlemi oluÅŸturamayÄ±z. Sadece cÃ¼zdan baÄŸlan dÃ¼ÄŸmesini gÃ¶steriyoruz ve kullanÄ±cÄ±ya baÄŸlanmasÄ± gerektiÄŸini bildiriyoruz.

Aksi takdirde, iÅŸlemi getirirken Ã¶nce kÃ¼Ã§Ã¼k bir yÃ¼kleme gÃ¶stergesi gÃ¶steririz. Elimize geÃ§tikten sonra, API tarafÄ±ndan dÃ¶ndÃ¼rÃ¼len mesajÄ± gÃ¶steririz. SayfayÄ± yenilerseniz, getirilen ve gÃ¼nlÃ¼ÄŸe kaydedilen iÅŸlemi ve gÃ¶sterilen mesajÄ± gÃ¶rmelisiniz:

![16](https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/d40d14cf-0a46-4801-94da-41cdc630796b)

Ä°ÅŸlemin gÃ¶nderilmesi
----------------------
Tamam gÃ¼zel, API'mizden bir iÅŸlem aldÄ±k! Åimdi bunu kullanÄ±cÄ±nÄ±n cÃ¼zdanÄ±na gÃ¶ndermek ve onaylamasÄ±nÄ± istemek iÃ§in sayfayÄ± gÃ¼ncelleyelim.

Ã–ncelikle, kancalarÄ± kullanarak biraz daha baÄŸlam yakalamamÄ±z gerekiyor:
```
import { useConnection, useWallet } from "@solana/wallet-adapter-react";

export default function Checkout() {
  const router = useRouter();
  const { connection } = useConnection();
  const { publicKey, sendTransaction } = useWallet();

  // unchanged below here
```

Solana baÄŸlantÄ±sÄ±nÄ± alÄ±yoruz ve ayrÄ±ca baÄŸlÄ± cÃ¼zdandan sendTransaction alÄ±yoruz. Bu, baÄŸlÄ± cÃ¼zdanÄ± kullanarak iÅŸlem gÃ¶ndermek iÃ§in kullanabileceÄŸimiz bir iÅŸlevdir.

Åimdi getTransaction ve onun useEffect kancasÄ±ndan sonra, baÅŸka bir fonksiyon ve kanca eklememiz gerekiyor:

```
// unchanged code before this
useEffect(() => {
  getTransaction()
}, [publicKey])

// Send the fetched transaction to the connected wallet
async function trySendTransaction() {
  if (!transaction) {
    return;
  }
  try {
    await sendTransaction(transaction, connection)
  } catch (e) {
    console.error(e)
  }
}

// Send the transaction once it's fetched
useEffect(() => {
  trySendTransaction()
}, [transaction])

// render code unchanged
```

Yeni kodu bu ÅŸekilde yerleÅŸtirmek biraz kafa karÄ±ÅŸtÄ±rÄ±cÄ± olabilir, kaybolursanÄ±z kodun tam hali (pages/checkout.tsx) :
```

import { useConnection, useWallet } from "@solana/wallet-adapter-react";
import { WalletMultiButton } from "@solana/wallet-adapter-react-ui";
import { Keypair, Transaction } from "@solana/web3.js";
import { useRouter } from "next/router";
import { useEffect, useMemo, useState } from "react";
import BackLink from "../components/BackLink";
import Loading from "../components/Loading";
import { MakeTransactionInputData, MakeTransactionOutputData } from "./api/makeTransaction";

export default function Checkout() {
  const router = useRouter();
  const { connection } = useConnection();
  const { publicKey, sendTransaction } = useWallet();

  // State to hold API response fields
  const [transaction, setTransaction] = useState<Transaction | null>(null);
  const [message, setMessage] = useState<string | null>(null);

  // Read the URL query (which includes our chosen products)
  const searchParams = new URLSearchParams();
  for (const [key, value] of Object.entries(router.query)) {
    if (value) {
      if (Array.isArray(value)) {
        for (const v of value) {
          searchParams.append(key, v);
        }
      } else {
        searchParams.append(key, value);
      }
    }
  }

  // Generate the unique reference which will be used for this transaction
  const reference = useMemo(() => Keypair.generate().publicKey, []);

  // Add it to the params we'll pass to the API
  searchParams.append('reference', reference.toString());

  // Use our API to fetch the transaction for the selected items
  async function getTransaction() {
    if (!publicKey) {
      return;
    }

    const body: MakeTransactionInputData = {
      account: publicKey.toString(),
    }

    const response = await fetch(`/api/makeTransaction?${searchParams.toString()}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body),
    })

    const json = await response.json() as MakeTransactionOutputData

    if (response.status !== 200) {
      console.error(json);
      return;
    }

    // Deserialize the transaction from the response
    const transaction = Transaction.from(Buffer.from(json.transaction, 'base64'));
    setTransaction(transaction);
    setMessage(json.message);
    console.log(transaction);
  }

  useEffect(() => {
    getTransaction()
  }, [publicKey])

  // Send the fetched transaction to the connected wallet
  async function trySendTransaction() {
    if (!transaction) {
      return;
    }
    try {
      await sendTransaction(transaction, connection)
    } catch (e) {
      console.error(e)
    }
  }

  // Send the transaction once it's fetched
  useEffect(() => {
    trySendTransaction()
  }, [transaction])

  if (!publicKey) {
    return (
      <div className='flex flex-col gap-8 items-center'>
        <div><BackLink href='/buy'>Cancel</BackLink></div>

        <WalletMultiButton />

        <p>You need to connect your wallet to make transactions</p>
      </div>
    )
  }

  return (
    <div className='flex flex-col gap-8 items-center'>
      <div><BackLink href='/buy'>Cancel</BackLink></div>

      <WalletMultiButton />

      {message ?
        <p>{message} Please approve the transaction using your wallet</p> :
        <p>Creating transaction... <Loading /></p>
      }
    </div>
  )
}
```

Ä°ÅŸlem durumu gÃ¼ncellendiÄŸinde (setTransaction'Ä± Ã§aÄŸÄ±rdÄ±ÄŸÄ±mÄ±zda bunu yaparÄ±z), sendTransaction'Ä± kullanarak bu iÅŸlemi kullanÄ±cÄ±nÄ±n cÃ¼zdanÄ±na gÃ¶ndeririz.

Ã–deme sayfasÄ±nÄ± ÅŸimdi yenilerseniz, Phantom sizden iÅŸlemi onaylamanÄ±zÄ± isteyecektir:

<img width="1399" alt="17" src="https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/9e964970-2f08-43b0-ad6f-ff965932e2f0">

Bu arada ilk aÃ§Ä±ldÄ±ÄŸÄ±nda SOL fiyatÄ±nÄ± gÃ¶stermeden Ã¶nce â€œÄ°ÅŸlem onaylanamayabilirâ€ gibi bir ÅŸey yazabilir. Bu normal. Orada gerÃ§ekte olan ÅŸey, cÃ¼zdanÄ±n Solana aÄŸÄ±ndan iÅŸlemi simÃ¼le etmesini istemesidir, bÃ¶ylece onaylarsanÄ±z ne olacaÄŸÄ±nÄ± size bildirebilir - bu durumda sizden 0,05 SOL Ã¼cretlendirilir. Ä°ÅŸlemi bir sÃ¼re onaysÄ±z bÄ±rakÄ±rsanÄ±z da olmayabilir. Bunun nedeni, daha Ã¶nce bahsettiÄŸimiz son blok hash iÅŸlemidir, iÅŸlem eskir ve yeniden oluÅŸturulmasÄ± gerekir.

Yine de onaylarsanÄ±z, ilk Solana iÅŸleminizi gÃ¶ndereceksiniz! GÃ¼zel!

KullanÄ±cÄ± arayÃ¼zÃ¼mÃ¼z henÃ¼z Ã¶deme yaptÄ±ÄŸÄ±nÄ±zÄ± bilmeyecek, dolayÄ±sÄ±yla orada hiÃ§bir ÅŸey olmayacak. SÄ±radaki iÅŸimiz bu! Ancak hesabÄ±nÄ±zÄ± Phantom'da kontrol ederseniz, iÅŸlemi orada gÃ¶receksiniz:

<img width="358" alt="18" src="https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/718a9db4-f3d8-4e5c-aa27-0fee3ccb9c10">

Ve bir iÅŸlem gÃ¶ndermek iÃ§in tek yapmamÄ±z gereken bu!

Ã–DEMENÄ°N TESPÄ°T EDÄ°LMESÄ°
----------------------------

Åimdiye kadarki kullanÄ±cÄ± deneyimi biraz sÄ±nÄ±rlÄ±, iÅŸlemi sunduÄŸumuzda kullanÄ±cÄ±nÄ±n Ã¶deme yapÄ±p yapmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in kendi cÃ¼zdanÄ±nÄ± kontrol etmesi gerekiyor. Bundan Ã§ok daha iyisini yapabiliriz!

Teknik olarak bunu Solana Pay olmadan yapabiliriz, ancak bunu gerÃ§ekten kolaylaÅŸtÄ±racak sÃ¼per kullanÄ±ÅŸlÄ± bir iÅŸlevi var. Ã–yleyse ÅŸimdi yÃ¼kleyelim:

```
npm install @solana/pay@0.2.0
```

Bu baÄŸÄ±mlÄ±lÄ±ÄŸÄ±, yalnÄ±zca bu Ã¶ÄŸreticide kullanÄ±lan API'lerin biz onu gÃ¼ncelleme fÄ±rsatÄ± bulamadan deÄŸiÅŸmeyeceÄŸinden emin olmak iÃ§in sÃ¼rÃ¼mlendiriyoruz.

pages/checkout.tsx'e bir tane daha useEffect ekleyeceÄŸiz:
```
// New import
import { findReference, FindReferenceError } from "@solana/pay";

// unchanged code before this
// Send the transaction once it's fetched
useEffect(() => {
  trySendTransaction()
}, [transaction])

// Check every 0.5s if the transaction is completed
useEffect(() => {
  const interval = setInterval(async () => {
    try {
      // Check if there is any transaction for the reference
      const signatureInfo = await findReference(connection, reference);
      console.log('They paid!!!')
    } catch (e) {
      if (e instanceof FindReferenceError) {
        // No transaction found yet, ignore this error
        return;
      }
      console.error('Unknown error', e)
    }
  }, 500)
  return () => {
    clearInterval(interval)
  }
}, [])

// render code unchanged
if (!publicKey) {
  return (
    ...
 
```
Yine ihtiyacÄ±nÄ±z varsa, kodun tamamÄ± :
```
import { useConnection, useWallet } from "@solana/wallet-adapter-react";
import { WalletMultiButton } from "@solana/wallet-adapter-react-ui";
import { Keypair, Transaction } from "@solana/web3.js";
import { findReference, FindReferenceError } from "@solana/pay";
import { useRouter } from "next/router";
import { useEffect, useMemo, useState } from "react";
import BackLink from "../components/BackLink";
import Loading from "../components/Loading";
import { MakeTransactionInputData, MakeTransactionOutputData } from "./api/makeTransaction";

export default function Checkout() {
  const router = useRouter();
  const { connection } = useConnection();
  const { publicKey, sendTransaction } = useWallet();

  // State to hold API response fields
  const [transaction, setTransaction] = useState<Transaction | null>(null);
  const [message, setMessage] = useState<string | null>(null);

  // Read the URL query (which includes our chosen products)
  const searchParams = new URLSearchParams();
  for (const [key, value] of Object.entries(router.query)) {
    if (value) {
      if (Array.isArray(value)) {
        for (const v of value) {
          searchParams.append(key, v);
        }
      } else {
        searchParams.append(key, value);
      }
    }
  }

  // Generate the unique reference which will be used for this transaction
  const reference = useMemo(() => Keypair.generate().publicKey, []);

  // Add it to the params we'll pass to the API
  searchParams.append('reference', reference.toString());

  // Use our API to fetch the transaction for the selected items
  async function getTransaction() {
    if (!publicKey) {
      return;
    }

    const body: MakeTransactionInputData = {
      account: publicKey.toString(),
    }

    const response = await fetch(`/api/makeTransaction?${searchParams.toString()}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(body),
    })

    const json = await response.json() as MakeTransactionOutputData

    if (response.status !== 200) {
      console.error(json);
      return;
    }

    // Deserialize the transaction from the response
    const transaction = Transaction.from(Buffer.from(json.transaction, 'base64'));
    setTransaction(transaction);
    setMessage(json.message);
    console.log(transaction);
  }

  useEffect(() => {
    getTransaction()
  }, [publicKey])

  // Send the fetched transaction to the connected wallet
  async function trySendTransaction() {
    if (!transaction) {
      return;
    }
    try {
      await sendTransaction(transaction, connection)
    } catch (e) {
      console.error(e)
    }
  }

  // Send the transaction once it's fetched
  useEffect(() => {
    trySendTransaction()
  }, [transaction])

  // Check every 0.5s if the transaction is completed
  useEffect(() => {
    const interval = setInterval(async () => {
      try {
        // Check if there is any transaction for the reference
        const signatureInfo = await findReference(connection, reference);
        console.log('They paid!!!')
      } catch (e) {
        if (e instanceof FindReferenceError) {
          // No transaction found yet, ignore this error
          return;
        }
        console.error('Unknown error', e)
      }
    }, 500)
    return () => {
      clearInterval(interval)
    }
  }, [])

  if (!publicKey) {
    return (
      <div className='flex flex-col items-center gap-8'>
        <div><BackLink href='/'>Cancel</BackLink></div>

        <WalletMultiButton />

        <p>You need to connect your wallet to make transactions</p>
      </div>
    )
  }

  return (
    <div className='flex flex-col items-center gap-8'>
      <div><BackLink href='/'>Cancel</BackLink></div>

      <WalletMultiButton />

      {message ?
        <p>{message} Please approve the transaction using your wallet</p> :
        <p>Creating transaction... <Loading /></p>
      }
    </div>
  )
}
```
ReferansÄ±mÄ±zÄ± kullanan herhangi bir iÅŸlem olup olmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in her 0,5 saniyede bir kontrol eden bir aralÄ±k ekledik. EÄŸer yoksa, o zaman findReference, yakaladÄ±ÄŸÄ±mÄ±z ve yok saydÄ±ÄŸÄ±mÄ±z bir FindReferenceError atar. ArtÄ±k Ã¶deme sayfamÄ±z, kullanÄ±cÄ±nÄ±n Ã¶deme yapÄ±p yapmadÄ±ÄŸÄ±nÄ± gÃ¶rmek iÃ§in arka planda oylamaya devam edecek.

```
findReference Ã§aÄŸrÄ±sÄ±, gizli olmayan referansÄ±mÄ±zÄ± kullanan herhangi bir iÅŸlemi bulacaktÄ±r. DoÄŸru iÅŸlemin yapÄ±ldÄ±ÄŸÄ±nÄ± garanti etmez. Bu durumda sorun yok Ã§Ã¼nkÃ¼ biz sadece kullanÄ±cÄ±ya geri bildirim gÃ¶steriyoruz. EÄŸitimin ilerleyen kÄ±sÄ±mlarÄ±nda, burada gÃ¼venliÄŸi iyileÅŸtirmenin yollarÄ±nÄ± gÃ¶receÄŸiz.
```

Ä°ÅŸlemi yeniler ve onaylarsanÄ±z, Ã¶dendiÄŸini belirten bir gÃ¼nlÃ¼k mesajÄ± gÃ¶rmelisiniz:

<img width="1144" alt="19" src="https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/3fd1d88c-99ae-4786-81d8-c3a5ab8adf51">

Åimdi kullanÄ±cÄ±ya Ã¶demesini aldÄ±ÄŸÄ±mÄ±zÄ± bildirmemiz gerekiyor!

ONAY SAYFASI EKLEME
-------------------------
KullanÄ±cÄ±ya Ã¶demesinin kabul edildiÄŸini bildirmek iÃ§in yeni bir sayfa ekleyeceÄŸiz.

Size benimkini nasÄ±l yaptÄ±ÄŸÄ±mÄ± gÃ¶stereceÄŸim ama baÅŸka bir ÅŸey yapmak isterseniz Ã§ekinmeyin! Uygulama sizin ğŸ™‚

Ä°lk olarak, yeni bir baÄŸÄ±mlÄ±lÄ±k var:
```
npm install react-circular-progressbar
```
Bu, gerÃ§ekten gÃ¼zel gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nÃ¼ dÃ¼ÅŸÃ¼ndÃ¼ÄŸÃ¼m dairesel bir ilerleme Ã§ubuÄŸuna animasyon ekliyor :

```
import { useEffect, useState } from "react"
import { buildStyles, CircularProgressbar } from "react-circular-progressbar"
import 'react-circular-progressbar/dist/styles.css';

export default function Confirmed() {
  const [percentage, setPercentage] = useState(0)
  const [text, setText] = useState('ğŸª')

  useEffect(() => {
    const t1 = setTimeout(() => setPercentage(100), 100)
    const t2 = setTimeout(() => setText('âœ…'), 600)

    return () => {
      clearTimeout(t1)
      clearTimeout(t2)
    }
  }, [])

  return (
    <CircularProgressbar value={percentage} text={text} styles={
      buildStyles({
        pathColor: '#00BA00',
      })
    } />
  )
}
```

Ä°lerleme Ã§ubuÄŸu kÃ¼tÃ¼phanesinin dahili bir animasyonu vardÄ±r, ancak yalnÄ±zca durum deÄŸiÅŸikliklerinde animasyon yapar - yani eÄŸer yalnÄ±zca %100 ilerlemeye sahip bir ilerleme Ã§ubuÄŸu oluÅŸturursak, animasyon gerÃ§ekleÅŸmez.Bu yÃ¼zden onu %0 ile oluÅŸturup, ardÄ±ndan %100'e animasyonla hareket ettiriyoruz.

React ilerleme Ã§ubuÄŸu hakkÄ±nda detaylÄ± bilgiye https://www.npmjs.com/package/react-circular-progressbar sitesinden ulaÅŸabilirsiniz.

Ve bu bileÅŸeni gÃ¶rÃ¼ntÃ¼lemek iÃ§in bir sayfa ekleyelim:
pages/confirmed.tsx dosyasÄ±nÄ± oluÅŸturuyoruz.

```
import BackLink from '../components/BackLink';
import Confirmed from '../components/Confirmed';
import PageHeading from '../components/PageHeading';

export default function ConfirmedPage() {
  return (
    <div className='flex flex-col gap-8 items-center'>
      <BackLink href='/'>Home</BackLink>

      <PageHeading>Thankyou, enjoy your cookies!</PageHeading>

      <div className='h-80 w-80'><Confirmed /></div>
    </div>
  )
}
```

Ve son olarak, Ã¶demeyi gÃ¶rdÃ¼ÄŸÃ¼mÃ¼z anda bu sayfaya yÃ¶nlendirmek iÃ§in Ã¶deme sayfamÄ±zdaki useEffect'i gÃ¼ncelleyebiliriz!
```
  // Check every 0.5s if the transaction is completed
  useEffect(() => {
    const interval = setInterval(async () => {
      try {
        // Check if there is any transaction for the reference
        const signatureInfo = await findReference(connection, reference);
        router.push('/confirmed')
      } catch (e) {
        if (e instanceof FindReferenceError) {
          // No transaction found yet, ignore this error
          return;
        }
        console.error('Unknown error', e)
      }
    }, 500)
    return () => {
      clearInterval(interval)
    }
  }, [])
```
Az Ã¶nce console.log satÄ±rÄ±nÄ± router.push('/confirmed') olacak ÅŸekilde dÃ¼zenledim.
Ve ÅŸimdi geÃ§erli bir Ã¶deme aldÄ±ÄŸÄ±mÄ±zda yeni onaylanan ekranÄ± gÃ¶rÃ¼ntÃ¼leyeceÄŸiz:

![tutorial__7clC2VD3oSsgx8mbh6Ak](https://github.com/Yusufcihan1/Solana-Pay-Tutorial/assets/50721899/11c7d3a9-4ba4-4551-a3da-35cf8b290951)

Bu noktada Solana kullanarak sitemizde Ã§erez satabiliriz!

Ancak Ã§erez dÃ¼kkanÄ±mÄ±za gelen pek Ã§ok kiÅŸi bir SOL'un deÄŸerinin ne olduÄŸunu bilmiyor olabilir. Bunun yerine onlarÄ± dolar olarak alabilseydik iyi olurdu!SÄ±radaki keÅŸfedeceÄŸimiz ÅŸey bu !

